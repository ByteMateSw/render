# SymmetricDS Server Configuration for PostgreSQL Master Node on Render.com (Supabase)
# ===============================================================================
# OPTIMIZADO PARA SUPABASE + RENDER.COM
# Variables configuradas en Render.com Dashboard > Environment

# Configuración del Motor
engine.name=supabase-server

# Configuración del Nodo
group.id=server
external.id=server-001

# URL de sincronización (auto-configurada con Render.com)
sync.url=${RENDER_EXTERNAL_URL}/sync/supabase-server

# Configuración de Base de Datos PostgreSQL SUPABASE
# VARIABLES OBLIGATORIAS en Render.com:
# - PG_HOST: aws-0-us-east-2.pooler.supabase.com
# - PG_PORT: 5432
# - PG_DB: postgres
# - PG_USER: postgres.swnwekychqqjmufqvkst (formato Supabase)
# - PG_PASS: tu_password_real
db.driver=org.postgresql.Driver
db.url=jdbc:postgresql://${PG_HOST}:${PG_PORT}/${PG_DB}?sslmode=require&ssl=true&sslcert=&sslkey=&sslrootcert=&sslfactory=org.postgresql.ssl.NonValidatingFactory&connectTimeout=30&socketTimeout=60&tcpKeepAlive=true
db.user=${PG_USER}
db.password=${PG_PASS}

# Pool de Conexiones optimizado para SUPABASE + Render.com
db.pool.initial.size=2
db.pool.max.size=15
db.pool.min.idle=1
db.pool.max.idle=5
db.pool.max.wait=30000
db.pool.test.on.borrow=true
db.pool.test.on.return=false
db.pool.test.while.idle=true
db.pool.validation.query=SELECT 1
db.pool.time.between.eviction.runs.millis=300000
db.pool.min.evictable.idle.time.millis=1800000

# Configuración SSL específica para SUPABASE
db.ssl=true
db.ssl.factory=org.postgresql.ssl.NonValidatingFactory

# Auto-registro (DESHABILITADO en servidor maestro)
auto.registration=false
registration.url=

# Jobs de sincronización 24/7 optimizados para cloud
start.route.job=true
start.outgoing.batches.job=true
start.incoming.batches.job=true
start.statistics.job=true
start.synctriggers.job=true
start.push.job=true
start.pull.job=true
start.heartbeat.job=true
start.purge.job=true
start.offline.push.job=false
start.offline.pull.job=false

# Configuración de Jobs (frecuencias optimizadas para Supabase)
job.routing.period.time.ms=10000
job.outgoing.batches.period.time.ms=10000
job.incoming.batches.period.time.ms=10000
job.push.period.time.ms=15000
job.pull.period.time.ms=15000
job.heartbeat.period.time.ms=60000
job.purge.period.time.ms=86400000

# Configuración de Lotes (optimizada para Supabase pooling)
outgoing.batch.max.bytes.to.sync=524288
incoming.batch.max.bytes.to.sync=524288
outgoing.batch.max.count.to.sync=500
incoming.batch.max.count.to.sync=500

# Configuración de Red optimizada para Supabase
http.timeout.ms=300000
http.concurrent.connections.per.pool=8
http.header.accept.charset=UTF-8
http.basic.auth.retry.count=3
http.connection.timeout.ms=45000
http.read.timeout.ms=90000

# Configuración de Seguridad
security.verify.hostname=false
https.allow.self.signed.certs=true

# Configuración Web para Render.com
web.enable=true
web.http.port=${PORT}
web.context.path=/sync
web.base.url=${RENDER_EXTERNAL_URL}

# Configuración de Log para Render.com
log.level=INFO
console.log.level=INFO
log4j.appender.CONSOLE.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p [%t] %c{1}: %m%n

# Configuración de Cache
cache.maximum.size=50000

# Configuración de Database específica para Supabase
auto.config.database=true
auto.config.registration=true

# Configuración de Initial Load
initial.load.use.extract.job=true
initial.load.use.reload.channel=true
initial.load.extract.timeout.ms=3600000

# Configuración de Cluster (single node)
cluster.locking.enabled=false

# JMX para monitoreo
jmx.agent.enable=true
jmx.agent.port=31416

# Configuración de transformaciones
transform.columns.enabled=true

# Configuración de archivos
sync.files.enabled=true
sync.files.max.size.bytes=5242880

# Configuración específica PostgreSQL + Supabase
db.native.extractor=false
db.treats.binary.as.lob=false
db.stream.binary.data=true
db.use.capture.lobs=false

# Configuración de estadísticas
statistic.record.enable=true
statistic.capture.time.in.ms=120000

# Configuración específica para Supabase pooling
db.connection.properties=socketTimeout=60&tcpKeepAlive=true&ApplicationName=SymmetricDS-Server

# Timeouts ajustados para Supabase
symmetric.runtime.config.table.prefix=sym_
symmetric.runtime.stats.enable=true

# Configuración de conexión persistente para Supabase
db.pool.test.query.timeout=30
db.pool.validation.timeout=10000

# Configuración específica de retry para Supabase
db.retry.count=3
db.retry.delay.ms=5000
