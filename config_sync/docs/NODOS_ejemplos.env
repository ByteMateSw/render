# ===============================================================================
# NODOS_ejemplos.env - Ejemplos de Configuración para Diferentes Sucursales
# ===============================================================================
# DESCRIPCIÓN: Este archivo contiene ejemplos de configuración para diferentes
#              tipos de sucursales y escenarios de despliegue
# USO: Copiar y personalizar según las necesidades de cada sucursal
# ===============================================================================

# ===============================================================================
# EJEMPLO 1: SUCURSAL PRINCIPAL (Centro)
# ===============================================================================
# Archivo: local-client-centro.properties

# Configuración del Motor
engine.name=local-client-centro

# Configuración del Nodo
group.id=client
external.id=sucursal-centro-001
sync.url=https://sync.midominio.com/sync/supabase-server

# Base de Datos Local
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/sistema_centro?useSSL=false&serverTimezone=America/Argentina/Buenos_Aires&allowPublicKeyRetrieval=true
db.user=root
db.password=admin123

# Configuración específica para sucursal principal
job.push.period.time.ms=3000
job.pull.period.time.ms=3000
outgoing.batch.max.bytes.to.sync=1048576
incoming.batch.max.bytes.to.sync=1048576

# ===============================================================================
# EJEMPLO 2: SUCURSAL SECUNDARIA (Zona Norte)
# ===============================================================================
# Archivo: local-client-norte.properties

# Configuración del Motor
engine.name=local-client-norte

# Configuración del Nodo
group.id=client
external.id=sucursal-norte-002
sync.url=https://sync.midominio.com/sync/supabase-server

# Base de Datos Local
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/sistema_norte?useSSL=false&serverTimezone=America/Argentina/Buenos_Aires&allowPublicKeyRetrieval=true
db.user=root
db.password=norte2024

# Configuración para conexión más lenta
job.push.period.time.ms=5000
job.pull.period.time.ms=5000
outgoing.batch.max.bytes.to.sync=524288
incoming.batch.max.bytes.to.sync=524288
http.timeout.ms=300000

# ===============================================================================
# EJEMPLO 3: SUCURSAL REMOTA (Conexión limitada)
# ===============================================================================
# Archivo: local-client-remota.properties

# Configuración del Motor
engine.name=local-client-remota

# Configuración del Nodo
group.id=client
external.id=sucursal-remota-003
sync.url=https://sync.midominio.com/sync/supabase-server

# Base de Datos Local
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/sistema_remota?useSSL=false&serverTimezone=America/Argentina/Buenos_Aires&allowPublicKeyRetrieval=true
db.user=root
db.password=remota2024

# Configuración optimizada para conexión lenta
job.push.period.time.ms=10000
job.pull.period.time.ms=10000
outgoing.batch.max.bytes.to.sync=262144
incoming.batch.max.bytes.to.sync=262144
outgoing.batch.max.count.to.sync=100
incoming.batch.max.count.to.sync=100
http.timeout.ms=600000
http.concurrent.connections.per.pool=2

# Configuración de retry más agresiva
http.basic.auth.retry.count=5
outgoing.batches.skip.duplicates=true

# ===============================================================================
# EJEMPLO 4: SUCURSAL CON MÚLTIPLES CAJAS
# ===============================================================================
# Archivo: local-client-multicaja.properties

# Configuración del Motor
engine.name=local-client-multicaja

# Configuración del Nodo
group.id=client
external.id=sucursal-multicaja-004
sync.url=https://sync.midominio.com/sync/supabase-server

# Base de Datos Local (compartida entre cajas)
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://192.168.1.100:3306/sistema_multicaja?useSSL=false&serverTimezone=America/Argentina/Buenos_Aires&allowPublicKeyRetrieval=true
db.user=caja_user
db.password=multicaja2024

# Pool de conexiones más grande
db.pool.initial.size=5
db.pool.max.size=30
db.pool.min.idle=5
db.pool.max.idle=10

# Frecuencias altas para múltiples cajas
job.push.period.time.ms=2000
job.pull.period.time.ms=2000
outgoing.batch.max.bytes.to.sync=2097152
incoming.batch.max.bytes.to.sync=2097152

# ===============================================================================
# PLANTILLA PARA NUEVAS SUCURSALES
# ===============================================================================
# Archivo: local-client-template.properties

# INSTRUCCIONES:
# 1. Copiar este template
# 2. Reemplazar todos los valores <PLACEHOLDER>
# 3. Ajustar configuraciones según necesidades específicas

# Configuración del Motor
engine.name=local-client-<NOMBRE_SUCURSAL>

# Configuración del Nodo
group.id=client
external.id=sucursal-<CODIGO_SUCURSAL>
sync.url=https://sync.<TU_DOMINIO>.com/sync/supabase-server

# Base de Datos Local
db.driver=com.mysql.cj.jdbc.Driver
db.url=jdbc:mysql://localhost:3306/<NOMBRE_BASE_DATOS>?useSSL=false&serverTimezone=<ZONA_HORARIA>&allowPublicKeyRetrieval=true
db.user=<USUARIO_MYSQL>
db.password=<PASSWORD_MYSQL>

# Pool de Conexiones (ajustar según carga)
db.pool.initial.size=3
db.pool.max.size=<MAX_CONEXIONES>
db.pool.min.idle=3
db.pool.max.idle=5

# Jobs de sincronización (ajustar según ancho de banda)
job.push.period.time.ms=<FRECUENCIA_PUSH>
job.pull.period.time.ms=<FRECUENCIA_PULL>

# Tamaño de batches (ajustar según conexión)
outgoing.batch.max.bytes.to.sync=<TAMAÑO_BATCH_OUT>
incoming.batch.max.bytes.to.sync=<TAMAÑO_BATCH_IN>

# Timeouts (ajustar según estabilidad de conexión)
http.timeout.ms=<TIMEOUT_HTTP>

# ===============================================================================
# CONFIGURACIONES ESPECÍFICAS POR TIPO DE SUCURSAL
# ===============================================================================

# TIPO A: SUCURSAL PRINCIPAL (alta capacidad, conexión excelente)
# - job.push.period.time.ms=2000
# - job.pull.period.time.ms=2000  
# - outgoing.batch.max.bytes.to.sync=2097152
# - incoming.batch.max.bytes.to.sync=2097152
# - http.timeout.ms=180000

# TIPO B: SUCURSAL ESTÁNDAR (capacidad media, conexión buena)
# - job.push.period.time.ms=5000
# - job.pull.period.time.ms=5000
# - outgoing.batch.max.bytes.to.sync=1048576
# - incoming.batch.max.bytes.to.sync=1048576  
# - http.timeout.ms=300000

# TIPO C: SUCURSAL REMOTA (baja capacidad, conexión limitada)
# - job.push.period.time.ms=10000
# - job.pull.period.time.ms=10000
# - outgoing.batch.max.bytes.to.sync=524288
# - incoming.batch.max.bytes.to.sync=524288
# - http.timeout.ms=600000

# ===============================================================================
# VARIABLES DE ENTORNO PARA AUTOMATIZACIÓN
# ===============================================================================

# Para usar en scripts de despliegue automático:
# export SUCURSAL_ID="sucursal-005"
# export SUCURSAL_NAME="Local Shopping"
# export DB_NAME="sistema_shopping"
# export DB_PASSWORD="shopping2024"
# export SYNC_FREQUENCY="5000"
# export BATCH_SIZE="1048576"

# Comando para generar configuración automática:
# sed -e "s/<CODIGO_SUCURSAL>/$SUCURSAL_ID/g" \
#     -e "s/<NOMBRE_BASE_DATOS>/$DB_NAME/g" \
#     -e "s/<PASSWORD_MYSQL>/$DB_PASSWORD/g" \
#     -e "s/<FRECUENCIA_PUSH>/$SYNC_FREQUENCY/g" \
#     -e "s/<TAMAÑO_BATCH_OUT>/$BATCH_SIZE/g" \
#     local-client-template.properties > local-client-$SUCURSAL_ID.properties

# ===============================================================================
# REGISTRO SQL PARA CADA TIPO DE SUCURSAL
# ===============================================================================

# SCRIPT SQL PARA SUCURSAL TIPO A (Principal)
/*
-- register_new_node_principal.sql
INSERT INTO sym_node VALUES('sucursal-centro-001', 'client', 'sucursal-centro-001', 1, null, '3.16.5', '3.16.5', 'mysql', '8.0', current_timestamp, '+00:00', 0, 0, current_timestamp, 'client');
INSERT INTO sym_node_security VALUES('sucursal-centro-001', 'centro_2024_secure_pass', 1, current_timestamp, 1, current_timestamp, current_timestamp, 1, current_timestamp);
*/

# SCRIPT SQL PARA SUCURSAL TIPO B (Estándar) 
/*
-- register_new_node_estandar.sql
INSERT INTO sym_node VALUES('sucursal-norte-002', 'client', 'sucursal-norte-002', 1, null, '3.16.5', '3.16.5', 'mysql', '8.0', current_timestamp, '+00:00', 0, 0, current_timestamp, 'client');
INSERT INTO sym_node_security VALUES('sucursal-norte-002', 'norte_2024_secure_pass', 1, current_timestamp, 1, current_timestamp, current_timestamp, 1, current_timestamp);
*/

# SCRIPT SQL PARA SUCURSAL TIPO C (Remota)
/*
-- register_new_node_remota.sql  
INSERT INTO sym_node VALUES('sucursal-remota-003', 'client', 'sucursal-remota-003', 1, null, '3.16.5', '3.16.5', 'mysql', '8.0', current_timestamp, '+00:00', 0, 0, current_timestamp, 'client');
INSERT INTO sym_node_security VALUES('sucursal-remota-003', 'remota_2024_secure_pass', 1, current_timestamp, 1, current_timestamp, current_timestamp, 1, current_timestamp);
*/

# ===============================================================================
# MONITOREO ESPECÍFICO POR SUCURSAL
# ===============================================================================

# Queries para monitorear cada tipo:

# Para sucursales principales (debe tener latencia <5 seg)
/*
SELECT node_id, last_lock_time, 
       extract(epoch from (current_timestamp - last_lock_time)) as seconds_since_last_sync
FROM sym_node_communication 
WHERE node_id LIKE 'sucursal-centro-%' 
AND communication_type = 'pull';
*/

# Para sucursales remotas (tolerancia hasta 30 seg)
/*
SELECT node_id, last_lock_time,
       extract(epoch from (current_timestamp - last_lock_time)) as seconds_since_last_sync
FROM sym_node_communication 
WHERE node_id LIKE 'sucursal-remota-%'
AND communication_type = 'pull';
*/

# ===============================================================================
# FIN DE EJEMPLOS
# ===============================================================================
